generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  // url fuera (env o config)
}

enum Weekday {
  lunes
  martes
  miercoles
  jueves
  viernes
  sabado
  domingo
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  exercises   Exercise[]
  plans       Plan[]
  workoutLogs WorkoutLog[]
}

model Exercise {
  id     String @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  name        String
  description String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  planBlockExercises PlanBlockExercise[]
  workoutLogs        WorkoutLog[]

  @@unique([userId, name])
  @@index([userId])
}

model Plan {
  id     String @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  name     String
  isActive Boolean @default(false)

  createdAt DateTime @default(now())
  workoutLogs WorkoutLog[]
  updatedAt DateTime @updatedAt

  days PlanDay[]

  @@unique([userId, name])
  @@index([userId])
}

model PlanDay {
  id     String  @id @default(cuid())
  planId String
  plan   Plan    @relation(fields: [planId], references: [id], onDelete: Cascade)

  day  Weekday
  name String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  blocks PlanBlock[]
  logs   WorkoutLog[]  // opcional, para linkear logs a este día

  @@unique([planId, day])
  @@index([planId])
}

model PlanBlock {
  id        String  @id @default(cuid())
  planDayId String
  planDay   PlanDay @relation(fields: [planDayId], references: [id], onDelete: Cascade)

  title String
  order Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  exercises PlanBlockExercise[]

  @@index([planDayId, order])
}

model PlanBlockExercise {
  id         String @id @default(cuid())
  blockId    String
  exerciseId String

  block    PlanBlock @relation(fields: [blockId], references: [id], onDelete: Cascade)
  exercise Exercise  @relation(fields: [exerciseId], references: [id], onDelete: Cascade)

  order       Int     @default(0)
  targetSets  Int?
  targetReps  String?
  restSeconds Int?

  @@unique([blockId, exerciseId])
  @@index([blockId, order])
  @@index([exerciseId])
}

model WorkoutLog {
  id String @id @default(cuid())

  userId String
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)

  exerciseId String
  exercise   Exercise @relation(fields: [exerciseId], references: [id], onDelete: Cascade)

  // Opcional: link al plan y/o día del plan
  planId    String?
  plan      Plan?    @relation(fields: [planId], references: [id], onDelete: SetNull)

  planDayId String?
  planDay   PlanDay? @relation(fields: [planDayId], references: [id], onDelete: SetNull)

  performedAt DateTime @default(now())
  notes       String?

  @@index([userId, performedAt])
  @@index([exerciseId, performedAt])
  @@index([planId])
  @@index([planDayId])
}
